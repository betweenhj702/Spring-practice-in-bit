package sdo.md.service;

import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Hashtable;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.UUID;

import org.springframework.stereotype.Service;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.multipart.MultipartHttpServletRequest;

import lombok.extern.log4j.Log4j;
import sdo.md.filesetting.Path;

@Log4j
@Service
public class DargdropServiceImpl implements DragdropService {
	private Map<String, List<String>> map;
	private MultipartHttpServletRequest multipartRequest;
	private String filestore = Path.FILE_STORE;
	@Override
	public Map<String, List<String>> getUpdateFileName() {
		upload();
		return null;
	}

	@Override
	public MultipartHttpServletRequest getMultipartRequest() {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public void setMultipartRequest(MultipartHttpServletRequest multipartRequest) {
		// TODO Auto-generated method stub

	}
	
	
	private void upload() {
		map = new Hashtable<String, List<String>>();
		
		Iterator<String> itr = multipartRequest.getFileNames();
		List<String> ofnames = new ArrayList<String>();
		List<String> savefnames = new ArrayList<String>();
		StringBuilder sb = null;
		while(itr.hasNext()) {
			sb = new StringBuilder();
			MultipartFile mpf = multipartRequest.getFile(itr.next());
			String ofname = mpf.getOriginalFilename();
			String savefname = sb.append(new SimpleDateFormat("yyyyMMddhhmmss").format(System.currentTimeMillis()))
					.append(UUID.randomUUID().toString())
					.append(ofname.substring(ofname.lastIndexOf("."))).toString();
			long fsize = mpf.getSize();
			log.info("#DragdropServiceImpl upload() ofname: " + ofname 
					+ ", savefname: "+savefname+", fsize: " + fsize );
		}
	}
}
